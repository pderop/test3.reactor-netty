name: Deploy Docs
on:
    push:
        branches:
            - "main"
    repository_dispatch:
        types: request-build-reference # legacy
    #schedule:
    #- cron: '0 10 * * *' # Once per day at 10am UTC
    workflow_dispatch:
#        permissions:
#            teams:
#                - 'reactor/team'

permissions: read-all
jobs:
    build:
        runs-on: ubuntu-latest
#        if: github.repository_owner == 'reactor'
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  ref: docs-build
                  fetch-depth: 1
            - name: Dispatch (partial build)
              if: github.ref_type == 'branch'
              env:
                  GH_TOKEN: ${{ github.token }}
              run: gh workflow run deploy-docs.yml -r $(git rev-parse --abbrev-ref HEAD) -f build-refname=${{ github.ref_name }}
            - name: Dispatch (full build)
              if: github.event_name == 'workflow_dispatch'
              env:
                  GH_TOKEN: ${{ github.token }}
              run: gh workflow run deploy-docs.yml -r $(git rev-parse --abbrev-ref HEAD)
